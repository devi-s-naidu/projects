<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Financial AI Agent</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>ðŸ“Š Financial AI Agent</h1>
    <p class="subtitle">Autonomous Market Insight Engine</p>

    <form method="post" action="/analyze">
        <input
            type="text"
            name="query"
            placeholder="Analyze NIFTY & BANKNIFTY outlook for next 7 days"
            required
        />
        <button type="submit">Run Analysis</button>
    </form>

    {% if result %}
    <div class="results">
        {% for market, insight in result.items() %}
        <div class="card">

            <h2>{{ market }}</h2>

            <p><strong>Trend:</strong> {{ insight.trend }}</p>
            <p><strong>Momentum:</strong> {{ insight.momentum }}</p>
            <p><strong>Volatility:</strong> {{ insight.volatility }}</p>
            <p><strong>RSI:</strong> {{ insight.rsi }}</p>

            <hr>

            <p class="action {{ insight.action }}">
                {{ insight.action }} | Risk: {{ insight.risk_level }}
            </p>
            <p><strong>Risk Score:</strong> {{ insight.risk_score }}/100</p>

            <!-- RSI Chart -->
            <canvas
                class="chart"
                data-label="RSI"
                data-dates='{{ insight.charts.dates | tojson }}'
                data-values='{{ insight.charts.rsi | tojson }}'>
            </canvas>

            <!-- MACD Chart -->
            <canvas
                class="chart"
                data-label="MACD"
                data-dates='{{ insight.charts.dates | tojson }}'
                data-values='{{ insight.charts.macd | tojson }}'>
            </canvas>

        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Chart Renderer -->
<script>
document.querySelectorAll(".chart").forEach(canvas => {
    const labels = JSON.parse(canvas.dataset.dates);
    const data = JSON.parse(canvas.dataset.values);
    const label = canvas.dataset.label;

    new Chart(canvas, {
        type: "line",
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                borderWidth: 2,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: { display: false }
            }
        }
    });
});
</script>

</body>
</html>
